# 4. 通讯报文设计

现阶段采用的通讯报文使用的类型是`Text`类型，在未来为了提升性能，将尝试使用`Hex`类型的报文来代替，以便显著压缩包的大小（至少压缩至原先的1/2）。

### 4.1 状态报文

状态报文主要用于在上下位机之间更新、同步状态信息。主要依靠报文长度来区分不同类型的状态报文。

#### 4.1.1 Face报文

**长度：72**

由于`FaceString`的长度为288，超过了UDP协议256个字节的传输上限，因而需要对齐进行一次压缩。因为原本脸字符串表示的是二进制数，因而简单的压缩方式就是将其压缩为十六进制数。压缩完后的Face报文大小为72个字节，为脸字符串的四分之一。

举例: `00000000000000c00c30030c00c30030000000000000003f000840012000300000000000`

#### 4.1.2 Color报文

**长度：7**

以#为开头的HEX颜色字符串（全小写）。通过颜色数据`Color`编码而来，也可以解码为颜色数据。

举例: `#f971d4`

#### 4.1.3 Bright报文

**长度：4**

以B为开头的亮度字符串。通过亮度数据`Bright`编码而来，也可以解码为亮度数据。

举例: `B032`

### 4.2 请求报文

由于下位机不会主动向上位机发送状态报文，因而需要上位机先发起一个请求。下位机收到请求报文后，再给上位机返回对应的状态报文。主要依靠全字匹配来区分不同类型的请求报文。

#### 4.2.1 Face请求报文

**匹配: requestFace**

上位机向下位机发起脸字符串`FaceString`同步请求，下位机将当前LED颜色编码为Face报文发回上位机。

#### 4.2.2 Color请求报文

**匹配: requestColor**

上位机向下位机发起颜色数据`Color`同步请求，下位机将当前LED颜色编码为Color报文发回上位机。

#### 4.2.3 Bright请求报文

上位机向下位机发起亮度数据`Bright`同步请求，下位机将当前LED颜色编码为Bright报文发回上位机。

**匹配: requestBright**